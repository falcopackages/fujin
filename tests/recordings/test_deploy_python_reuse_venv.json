[
  "mkdir -p /home/testuser/.local/share/fujin/testapp",
  "echo 'FOO=bar' > /home/testuser/.local/share/fujin/testapp/.env",
  "mkdir -p /home/testuser/.local/share/fujin/testapp/v0.1.0",
  "echo 'set -a  # Automatically export all variables\nsource .env\nset +a  # Stop automatic export\nexport UV_COMPILE_BYTECODE=1\nexport UV_PYTHON=python3.12\nexport PATH=\".venv/bin:$PATH\"' > /home/testuser/.local/share/fujin/testapp/.appenv",
  "head -n 1 .versions",
  "md5sum /home/testuser/.local/share/fujin/testapp/v0.0.1/requirements.txt",
  "cp /home/testuser/.local/share/fujin/testapp/v0.0.1/requirements.txt /home/testuser/.local/share/fujin/testapp/v0.1.0/requirements.txt",
  "uv pip install /home/testuser/.local/share/fujin/testapp/v0.1.0/testapp-0.1.0.whl",
  "head -n 1 .versions",
  "sed -i '1i 0.1.0' .versions",
  "echo '# All options are documented here https://www.freedesktop.org/software/systemd/man/latest/systemd.exec.html\n# Inspiration was taken from here https://docs.gunicorn.org/en/stable/deploy.html#systemd\n[Unit]\nDescription=testapp\n\nAfter=network.target\n\n[Service]\n#Type=notify\n#NotifyAccess=main\nUser=testuser\nGroup=testuser\nRuntimeDirectory=testapp\nWorkingDirectory=/home/testuser/.local/share/fujin/testapp\nExecStart=/home/testuser/.local/share/fujin/testapp/run web\nEnvironmentFile=/home/testuser/.local/share/fujin/testapp/.env\nExecReload=/bin/kill -s HUP $MAINPID\nKillMode=mixed\nTimeoutStopSec=5\nPrivateTmp=true\n# if your app does not need administrative capabilities, let systemd know\nProtectSystem=strict\n\n[Install]\nWantedBy=multi-user.target' | sudo tee /etc/systemd/system/testapp.service",
  "echo '# All options are documented here https://www.freedesktop.org/software/systemd/man/latest/systemd.exec.html\n[Unit]\nDescription=testapp-worker@\n\n[Service]\nUser=testuser\nGroup=testuser\nWorkingDirectory=/home/testuser/.local/share/fujin/testapp\nExecStart=/home/testuser/.local/share/fujin/testapp/run worker\nEnvironmentFile=/home/testuser/.local/share/fujin/testapp/.env\nRestart=always\n\n[Install]\nWantedBy=multi-user.target' | sudo tee /etc/systemd/system/testapp-worker@.service",
  "sudo systemctl daemon-reload",
  "sudo systemctl enable --now testapp.service testapp-worker@1.service testapp-worker@2.service",
  "systemctl list-units --full --all --plain --no-legend 'testapp*'",
  "ls /etc/systemd/system/testapp*",
  "ls /etc/systemd/system/multi-user.target.wants/testapp*",
  "sudo systemctl restart testapp.service testapp-worker@1.service testapp-worker@2.service",
  "echo 'example.com {\n\t\n\n\treverse_proxy localhost:8000\n}' | sudo tee /etc/caddy/conf.d/testapp.caddy",
  "sudo systemctl reload caddy",
  "sed -n '6,$p' .versions"
]
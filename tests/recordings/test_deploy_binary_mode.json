[
  "mkdir -p /home/testuser/.local/share/fujin/myapp",
  "echo 'FOO=bar' > /home/testuser/.local/share/fujin/myapp/.env",
  "mkdir -p /home/testuser/.local/share/fujin/myapp/v0.1.0",
  "echo 'set -a  # Automatically export all variables\nsource .env\nset +a  # Stop automatic export\nexport PATH=\"/home/testuser/.local/share/fujin/myapp:$PATH\"' > /home/testuser/.local/share/fujin/myapp/.appenv",
  "rm /home/testuser/.local/share/fujin/myapp/myapp",
  "ln -s /home/testuser/.local/share/fujin/myapp/v0.1.0/testapp-0.1.0.whl /home/testuser/.local/share/fujin/myapp/myapp",
  "head -n 1 .versions",
  "sed -i '1i 0.1.0' .versions",
  "echo '# All options are documented here https://www.freedesktop.org/software/systemd/man/latest/systemd.exec.html\n# Inspiration was taken from here https://docs.gunicorn.org/en/stable/deploy.html#systemd\n[Unit]\nDescription=myapp\n\nAfter=network.target\n\n[Service]\n#Type=notify\n#NotifyAccess=main\nUser=testuser\nGroup=testuser\nRuntimeDirectory=myapp\nWorkingDirectory=/home/testuser/.local/share/fujin/myapp\nExecStart=/home/testuser/.local/share/fujin/myapp/run web\nEnvironmentFile=/home/testuser/.local/share/fujin/myapp/.env\nExecReload=/bin/kill -s HUP $MAINPID\nKillMode=mixed\nTimeoutStopSec=5\nPrivateTmp=true\n# if your app does not need administrative capabilities, let systemd know\nProtectSystem=strict\n\n[Install]\nWantedBy=multi-user.target' | sudo tee /etc/systemd/system/myapp.service",
  "echo '# All options are documented here https://www.freedesktop.org/software/systemd/man/latest/systemd.exec.html\n[Unit]\nDescription=myapp-worker@\n\n[Service]\nUser=testuser\nGroup=testuser\nWorkingDirectory=/home/testuser/.local/share/fujin/myapp\nExecStart=/home/testuser/.local/share/fujin/myapp/run worker\nEnvironmentFile=/home/testuser/.local/share/fujin/myapp/.env\nRestart=always\n\n[Install]\nWantedBy=multi-user.target' | sudo tee /etc/systemd/system/myapp-worker@.service",
  "sudo systemctl daemon-reload",
  "sudo systemctl enable --now myapp.service myapp-worker@1.service myapp-worker@2.service",
  "systemctl list-units --full --all --plain --no-legend 'myapp*'",
  "ls /etc/systemd/system/myapp*",
  "ls /etc/systemd/system/multi-user.target.wants/myapp*",
  "sudo systemctl restart myapp.service myapp-worker@1.service myapp-worker@2.service",
  "echo 'example.com {\n\t\n\n\treverse_proxy localhost:8000\n}' | sudo tee /etc/caddy/conf.d/myapp.caddy",
  "sudo systemctl reload caddy",
  "sed -n '6,$p' .versions",
  "rm -r ",
  "sed -i '6,$d' .versions"
]